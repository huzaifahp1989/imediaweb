import{r as o,j as e,C as B,a as E,b as P,G as _,c as A,m as x,e as F,B as S,S as k,A as D,g as u,f as N}from"./index-Dh-JI_tc.js";import{Z as I}from"./zap-WiL2oK7f.js";const c=[{id:1,label:"50 Points",value:50,type:"points",color:"#10B981",icon:"â­"},{id:2,label:"Badge",value:"Super Learner",type:"badge",color:"#F59E0B",icon:"ðŸ…"},{id:3,label:"100 Points",value:100,type:"points",color:"#3B82F6",icon:"ðŸ’Ž"},{id:4,label:"Wallpaper",value:"Islamic Art",type:"wallpaper",color:"#8B5CF6",icon:"ðŸŽ¨"},{id:5,label:"25 Points",value:25,type:"points",color:"#EC4899",icon:"âœ¨"},{id:6,label:"Giveaway Entry",value:"Monthly Prize",type:"giveaway_entry",color:"#EF4444",icon:"ðŸŽ"},{id:7,label:"75 Points",value:75,type:"points",color:"#14B8A6",icon:"ðŸŒŸ"},{id:8,label:"Bonus Spin",value:"Extra Spin",type:"bonus_spin",color:"#F97316",icon:"ðŸŽ¯"}];function $({user:n,onReward:g}){const[d,w]=o.useState(!1),[y,C]=o.useState(0),[p,h]=o.useState(null),[i,m]=o.useState(!0),[v,M]=o.useState(null);o.useEffect(()=>{j()},[n]);const j=()=>{if(!n)return;const t=n.last_spin_date;if(!t){m(!0);return}const s=new Date(t);if((new Date-s)/(1e3*60*60)>=24)m(!0);else{m(!1);const b=new Date(s.getTime()+1440*60*1e3);M(b)}},R=async()=>{if(!i||d)return;w(!0);const t=Math.floor(Math.random()*c.length),s=360/c.length,r=t*s,b=(3+Math.floor(Math.random()*3))*360+r;C(y+b),setTimeout(async()=>{const a=c[t];h(a),w(!1);try{if(await u.entities.SpinReward.create({user_id:n.id,reward_type:a.type,reward_value:a.type==="points"?a.value.toString():a.value,claimed:!1}),await u.auth.updateMe({last_spin_date:new Date().toISOString()}),a.type==="points"){const l=Math.min((n.points||0)+a.value,400);await u.auth.updateMe({points:l})}else if(a.type==="badge"){const l=n.badges||[];l.includes(a.value)||await u.auth.updateMe({badges:[...l,a.value]})}m(!1),j(),g&&g(a)}catch(l){console.error("Error saving reward:",l)}},4e3)},T=()=>{if(!v)return"";const s=v-new Date,r=Math.floor(s/(1e3*60*60)),f=Math.floor(s%(1e3*60*60)/(1e3*60));return`${r}h ${f}m`};return e.jsxs(B,{className:"border-2 border-amber-300 shadow-2xl",children:[e.jsx(E,{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white",children:e.jsxs(P,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-6 h-6"}),"Spin to Win!"]})}),e.jsxs(A,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-80 h-80 mb-6",children:[e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 z-10",children:e.jsx("div",{className:"w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-t-[40px] border-t-red-500 drop-shadow-lg"})}),e.jsxs(x.div,{className:"w-full h-full rounded-full relative overflow-hidden border-8 border-amber-400 shadow-2xl",animate:{rotate:y},transition:{duration:4,ease:"easeOut"},children:[c.map((t,s)=>{const r=360/c.length*s;return e.jsx("div",{className:"absolute w-full h-full",style:{transform:`rotate(${r}deg)`,transformOrigin:"center"},children:e.jsx("div",{className:"absolute top-0 left-1/2 w-0 h-0",style:{borderLeft:"160px solid transparent",borderRight:"160px solid transparent",borderTop:`160px solid ${t.color}`,transform:"translateX(-50%)"},children:e.jsxs("div",{className:"absolute text-center text-white font-bold text-sm",style:{top:"-140px",left:"-40px",width:"80px",transform:"rotate(0deg)"},children:[e.jsx("div",{className:"text-2xl mb-1",children:t.icon}),e.jsx("div",{className:"text-xs",children:t.label})]})})},t.id)}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full border-4 border-amber-500 flex items-center justify-center shadow-lg",children:e.jsx(F,{className:"w-8 h-8 text-amber-500"})})]})]}),e.jsx(S,{onClick:R,disabled:!i||d,size:"lg",className:`w-full max-w-xs ${i&&!d?"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600":"bg-gray-400"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx(x.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"mr-2",children:e.jsx(I,{className:"w-5 h-5"})}),"Spinning..."]}):i?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Spin Now!"]}):e.jsxs(e.Fragment,{children:["Next spin in: ",T()]})}),!i&&e.jsx("p",{className:"text-sm text-gray-600 mt-3 text-center",children:"You can spin once every 24 hours! â°"})]}),e.jsx(D,{children:p&&e.jsx(x.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"fixed inset-0 flex items-center justify-center z-50 bg-black/50 p-4",onClick:()=>h(null),children:e.jsx(x.div,{initial:{y:-50},animate:{y:0},className:"bg-white rounded-2xl p-8 max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:p.icon}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Congratulations! ðŸŽ‰"}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"You won:"}),e.jsx("div",{className:"text-3xl font-bold mb-6",style:{color:p.color},children:p.label}),e.jsx(S,{onClick:()=>h(null),className:"bg-gradient-to-r from-green-500 to-teal-500",children:"Awesome!"})]})})})})]})]})}$.propTypes={user:N.object.isRequired,onReward:N.func};export{$ as default};
